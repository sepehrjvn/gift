<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no, viewport-fit=cover" />
  <title>Ù‚Ø§Ø¨ Ø¹Ú©Ø³ WebAR â€“ Ù†Ù…ÙˆÙ†Ù‡ Ø§ÙˆÙ„ÛŒÙ‡</title>
  <!-- A-Frame Ùˆ MindAR Ø§Ø² CDN -->
  <script src="https://unpkg.com/aframe@1.5.0/dist/aframe.min.js"></script>
  <script src="https://unpkg.com/mind-ar@1.2.5/dist/mindar-image-aframe.prod.js"></script>
  <style>
    body, html { margin: 0; padding: 0; background:#000; height: 100%; }
    #ui { position: fixed; z-index: 10; inset: 0 auto auto 0; padding: 10px; color: #fff; font-family: sans-serif; }
    .hint { position: fixed; inset: auto 0 0 0; color:#fff; text-align:center; padding:10px; background:linear-gradient(transparent, rgba(0,0,0,.6)); font-family: sans-serif; }
    .btn { background:#ffffff22; border:1px solid #ffffff55; color:#fff; padding:6px 10px; border-radius:10px; cursor:pointer; margin-inline-end:6px; }
  </style>
</head>
<body>
  <!-- UI Ø³Ø§Ø¯Ù‡ Ø¨Ø±Ø§ÛŒ Ú©Ù†ØªØ±Ù„ Ùˆ Ø±Ø§Ù‡Ù†Ù…Ø§ÛŒ Ú©Ø§Ø±Ø¨Ø± -->
  <div id="ui">
    <button id="btnStart" class="btn">Ø´Ø±ÙˆØ¹ Ø§Ø³Ú©Ù†</button>
    <button id="btnMute" class="btn">ğŸ”‡ Ø¨ÛŒâ€ŒØµØ¯Ø§</button>
  </div>
  <div class="hint">Ú¯ÙˆØ´ÛŒ Ø±Ø§ Ø¨Ù‡ Ù‚Ø§Ø¨/ØªØµÙˆÛŒØ± Ù‡Ø¯Ù Ø¨Ú¯ÛŒØ±ÛŒØ¯ ØªØ§ ÙˆÛŒØ¯Ø¦Ùˆ Ø¯Ø§Ø®Ù„ Ù‚Ø§Ø¨ Ù¾Ø®Ø´ Ø´ÙˆØ¯.</div>

  <!-- ØµØ­Ù†Ù‡ WebAR: MindAR Ø¨Ø§ A-Frame Ùˆ Ø±Ø¯ÛŒØ§Ø¨ÛŒ ØªØµÙˆÛŒØ± -->
  <a-scene
    mindar-image="imageTargetSrc: ./targets/target.mind; filterMinCF:0.001; filterBeta: 0.01; warmupTolerance: 5;"
    vr-mode-ui="enabled: false"
    device-orientation-permission-ui="enabled: false"
    renderer="colorManagement: true, physicallyCorrectLights: true"
    embedded>

    <!-- Ø¯ÙˆØ±Ø¨ÛŒÙ† MindAR -->
    <a-camera position="0 0 0" look-controls="enabled: false"></a-camera>

    <!-- Ø±ÛŒØ´Ù‡ ÙˆÛŒÚ˜Ú¯ÛŒÙ Ù‡Ø¯Ù Ø´Ù…Ø§Ø±Ù‡ Û° -->
    <a-entity mindar-image-target="targetIndex: 0">
      <!-- Ø³Ø·Ø­ Ù¾Ø®Ø´ ÙˆÛŒØ¯Ø¦Ùˆ: Ø§Ø¨Ø¹Ø§Ø¯ Ø§ÛŒÙ† ØµÙØ­Ù‡ Ø¨Ø§ÛŒØ¯ Ø¨Ø§ Ù†Ø³Ø¨Øª ØªØµÙˆÛŒØ± Ù‡Ø¯Ù Ù‡Ù…Ø§Ù‡Ù†Ú¯ Ø¨Ø§Ø´Ø¯ -->
      <a-video
        id="videoPlane"
        src="#videoEl"
        position="0 0 0"
        rotation="0 0 0"
        width="1"
        height="0.5625"  
        material="shader: flat; transparent: true;"
        loop="true"
      ></a-video>

      <!-- ÛŒÚ© Ø­Ø§Ø´ÛŒÙ‡â€ŒÛŒ Ù†Ø§Ø²Ú© Ø¨Ø±Ø§ÛŒ Ø§Ù„Ù‚Ø§ÛŒ Ø­Ø³ Â«Ø¯Ø§Ø®Ù„ Ù‚Ø§Ø¨ Ø¨ÙˆØ¯Ù†Â» -->
      <a-plane position="0 0 -0.002" width="1.05" height="0.59" color="#111" material="opacity:0.6"></a-plane>
    </a-entity>
  </a-scene>

  <!-- Ø§Ù„Ù…Ø§Ù† ÙˆÛŒØ¯Ø¦Ùˆ ÙˆØ§Ù‚Ø¹ÛŒ HTML5 Ú©Ù‡ Ø±ÙˆÛŒ ØµÙØ­Ù‡ Ø³Ù‡â€ŒØ¨Ø¹Ø¯ÛŒ Ù†Ú¯Ø§Ø´Øª Ù…ÛŒâ€ŒØ´ÙˆØ¯ -->
  <video id="videoEl" playsinline webkit-playsinline preload="auto" muted loop style="display:none">
    <!-- ÙˆÛŒØ¯Ø¦ÙˆÛŒ Ø®ÙˆØ¯ Ø±Ø§ Ø¬Ø§ÛŒÚ¯Ø²ÛŒÙ† Ú©Ù†ÛŒØ¯ -->
    <source src="./targets/video.mp4" type="video/mp4" />
  </video>

  <script>
    // Ú©Ù†ØªØ±Ù„â€ŒÙ‡Ø§ÛŒ Ø³Ø§Ø¯Ù‡ Ø¨Ø±Ø§ÛŒ Ø´Ø±ÙˆØ¹/ØªÙˆÙ‚Ù Ø§Ø³Ú©Ù† Ùˆ Ø¨ÛŒâ€ŒØµØ¯Ø§/Ø¨Ø§ ØµØ¯Ø§
    const btnStart = document.getElementById('btnStart');
    const btnMute = document.getElementById('btnMute');
    const videoEl = document.getElementById('videoEl');

    // iOS Ùˆ Ø¨Ø³ÛŒØ§Ø±ÛŒ Ø§Ø² Ù…Ø±ÙˆØ±Ú¯Ø±Ù‡Ø§ ÙÙ‚Ø· ÙˆÛŒØ¯Ø¦ÙˆÛŒ Â«mutedÂ» Ø±Ø§ Ø®ÙˆØ¯Ú©Ø§Ø± Ù¾Ø®Ø´ Ù…ÛŒâ€ŒÚ©Ù†Ù†Ø¯
    videoEl.muted = true;

    // ÙˆÙ‚ØªÛŒ Ù‡Ø¯Ù Ù¾ÛŒØ¯Ø§ Ø´Ø¯ØŒ ÙˆÛŒØ¯Ø¦Ùˆ Ø±Ø§ Ù¾Ø®Ø´ Ú©Ù†
    const sceneEl = document.querySelector('a-scene');
    sceneEl.addEventListener('targetFound', () => {
      videoEl.play().catch(()=>{});
    });
    sceneEl.addEventListener('targetLost', () => {
      videoEl.pause();
    });

    btnStart.addEventListener('click', async () => {
      try {
        // Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ø¯Ø³ØªØ±Ø³ÛŒ Ø¨Ù‡ Ø¯ÙˆØ±Ø¨ÛŒÙ†
        await navigator.mediaDevices.getUserMedia({ video: true });
        // Ø´Ø±ÙˆØ¹ MindAR (ÙˆÙ‚ØªÛŒ Ú©Ø§Ø±Ø¨Ø± Ø¨Ø§ UI ØªØ¹Ø§Ù…Ù„ Ú©Ù†Ø¯ØŒ Ù…Ø­Ø¯ÙˆØ¯ÛŒØªâ€ŒÙ‡Ø§ÛŒ autoplay Ø±ÙØ¹ Ù…ÛŒâ€ŒØ´ÙˆØ¯)
        sceneEl.systems['mindar-image-system'].start();
        // Ø´Ø±ÙˆØ¹ Ù¾Ø®Ø´ Ø¨ÛŒâ€ŒØµØ¯Ø§ (Ø¨Ø±Ø§ÛŒ iOS)
        await videoEl.play().catch(()=>{});
        btnStart.textContent = 'Ø§Ø³Ú©Ù† ÙØ¹Ø§Ù„ Ø§Ø³Øª';
        btnStart.disabled = true;
      } catch (e) {
        alert('Ø¹Ø¯Ù… Ø¯Ø³ØªØ±Ø³ÛŒ Ø¨Ù‡ Ø¯ÙˆØ±Ø¨ÛŒÙ†. Ù„Ø·ÙØ§Ù‹ Ø§Ø¬Ø§Ø²Ù‡â€ŒÛŒ Ø¯Ø³ØªØ±Ø³ÛŒ Ø¨Ø¯Ù‡ÛŒØ¯.');
      }
    });

    btnMute.addEventListener('click', () => {
      videoEl.muted = !videoEl.muted;
      btnMute.textContent = videoEl.muted ? 'ğŸ”‡ Ø¨ÛŒâ€ŒØµØ¯Ø§' : 'ğŸ”Š Ø¨Ø§ ØµØ¯Ø§';
      if (!videoEl.paused) videoEl.play().catch(()=>{});
    });
  </script>
</body>
</html>
