<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no, viewport-fit=cover" />
  <title>Ù‚Ø§Ø¨ Ø¹Ú©Ø³ WebAR â€“ Ù†Ù…ÙˆÙ†Ù‡ Ø§ÙˆÙ„ÛŒÙ‡</title>
  <!-- A-Frame Ùˆ MindAR Ø§Ø² CDN -->
  <script src="https://unpkg.com/aframe@1.5.0/dist/aframe.min.js"></script>
  <script src="https://unpkg.com/mind-ar@1.2.5/dist/mindar-image-aframe.prod.js"></script>
  <style>
    body, html { margin: 0; padding: 0; background:#000; height: 100%; }
    #ui { position: fixed; z-index: 10; inset: 0 auto auto 0; padding: 10px; color: #fff; font-family: sans-serif; }
    .hint { position: fixed; inset: auto 0 0 0; color:#fff; text-align:center; padding:10px; background:linear-gradient(transparent, rgba(0,0,0,.6)); font-family: sans-serif; }
    .btn { background:#ffffff22; border:1px solid #ffffff55; color:#fff; padding:6px 10px; border-radius:10px; cursor:pointer; margin-inline-end:6px; }
  </style>
</head>
<body>
  <!-- UI Ø³Ø§Ø¯Ù‡ Ø¨Ø±Ø§ÛŒ Ú©Ù†ØªØ±Ù„ Ùˆ Ø±Ø§Ù‡Ù†Ù…Ø§ÛŒ Ú©Ø§Ø±Ø¨Ø± -->
  <div id="ui">
    <button id="btnStart" class="btn">Ø´Ø±ÙˆØ¹ Ø§Ø³Ú©Ù†</button>
    <button id="btnMute" class="btn">ğŸ”‡ Ø¨ÛŒâ€ŒØµØ¯Ø§</button>
  </div>
  <div class="hint">Ú¯ÙˆØ´ÛŒ Ø±Ø§ Ø¨Ù‡ Ù‚Ø§Ø¨/ØªØµÙˆÛŒØ± Ù‡Ø¯Ù Ø¨Ú¯ÛŒØ±ÛŒØ¯ ØªØ§ ÙˆÛŒØ¯Ø¦Ùˆ Ø¯Ø§Ø®Ù„ Ù‚Ø§Ø¨ Ù¾Ø®Ø´ Ø´ÙˆØ¯.</div>

  <!-- ØµØ­Ù†Ù‡ WebAR: MindAR Ø¨Ø§ A-Frame Ùˆ Ø±Ø¯ÛŒØ§Ø¨ÛŒ ØªØµÙˆÛŒØ± -->
  <a-scene
    mindar-image="imageTargetSrc: ./targets/target.mind; filterMinCF:0.001; filterBeta: 0.01; warmupTolerance: 5;"
    vr-mode-ui="enabled: false"
    device-orientation-permission-ui="enabled: false"
    renderer="colorManagement: true, physicallyCorrectLights: true"
    embedded>

    <!-- Ø¯ÙˆØ±Ø¨ÛŒÙ† MindAR -->
    <a-camera position="0 0 0" look-controls="enabled: false"></a-camera>

    <!-- Ø±ÛŒØ´Ù‡ ÙˆÛŒÚ˜Ú¯ÛŒÙ Ù‡Ø¯Ù Ø´Ù…Ø§Ø±Ù‡ Û° -->
    <a-entity mindar-image-target="targetIndex: 0">
      <!-- Ø³Ø·Ø­ Ù¾Ø®Ø´ ÙˆÛŒØ¯Ø¦Ùˆ: Ø§Ø¨Ø¹Ø§Ø¯ Ø§ÛŒÙ† ØµÙØ­Ù‡ Ø¨Ø§ÛŒØ¯ Ø¨Ø§ Ù†Ø³Ø¨Øª ØªØµÙˆÛŒØ± Ù‡Ø¯Ù Ù‡Ù…Ø§Ù‡Ù†Ú¯ Ø¨Ø§Ø´Ø¯ -->
      <a-video
        id="videoPlane"
        src="#videoEl"
        position="0 0 0"
        rotation="0 0 0"
        width="1"
        height="0.5625"  
        material="shader: flat; transparent: true;"
        loop="true"
      ></a-video>

      <!-- ÛŒÚ© Ø­Ø§Ø´ÛŒÙ‡â€ŒÛŒ Ù†Ø§Ø²Ú© Ø¨Ø±Ø§ÛŒ Ø§Ù„Ù‚Ø§ÛŒ Ø­Ø³ Â«Ø¯Ø§Ø®Ù„ Ù‚Ø§Ø¨ Ø¨ÙˆØ¯Ù†Â» -->
      <a-plane position="0 0 -0.002" width="1.05" height="0.59" color="#111" material="opacity:0.6"></a-plane>
    </a-entity>
  </a-scene>

  <!-- Ø§Ù„Ù…Ø§Ù† ÙˆÛŒØ¯Ø¦Ùˆ ÙˆØ§Ù‚Ø¹ÛŒ HTML5 Ú©Ù‡ Ø±ÙˆÛŒ ØµÙØ­Ù‡ Ø³Ù‡â€ŒØ¨Ø¹Ø¯ÛŒ Ù†Ú¯Ø§Ø´Øª Ù…ÛŒâ€ŒØ´ÙˆØ¯ -->
  <video id="videoEl" playsinline webkit-playsinline preload="auto" muted loop style="display:none">
    <!-- ÙˆÛŒØ¯Ø¦ÙˆÛŒ Ø®ÙˆØ¯ Ø±Ø§ Ø¬Ø§ÛŒÚ¯Ø²ÛŒÙ† Ú©Ù†ÛŒØ¯ -->
    <source src="./targets/video.mp4" type="video/mp4" />
  </video>

  <script>
     const btnStart = document.getElementById('btnStart');
  const videoEl = document.getElementById('videoEl');
  const sceneEl = document.querySelector('a-scene');

  videoEl.muted = true; // Ø¨Ø±Ø§ÛŒ autoplay Ø¯Ø± Ù…ÙˆØ¨Ø§ÛŒÙ„

  btnStart.addEventListener('click', async () => {
    try {
      if (!isSecureContext) {
        alert('Ø§ÛŒÙ† ØµÙØ­Ù‡ Ø¨Ø§ÛŒØ¯ Ø±ÙˆÛŒ HTTPS Ø¨Ø§Ø´Ø¯.');
        return;
      }
      // ÙÙ‚Ø· MindAR Ø¯ÙˆØ±Ø¨ÛŒÙ† Ø±Ùˆ Ù…ÛŒâ€ŒÚ¯ÛŒØ±Ù‡
      await sceneEl.systems['mindar-image-system'].start();

      // Ø´Ø±ÙˆØ¹ Ù¾Ø®Ø´ Ø¨ÛŒâ€ŒØµØ¯Ø§ (iOS)
      await videoEl.play().catch(()=>{});
      btnStart.textContent = 'Ø§Ø³Ú©Ù† ÙØ¹Ø§Ù„ Ø§Ø³Øª';
      btnStart.disabled = true;
    } catch (err) {
      alert('Ø®Ø·Ø§ÛŒ Ø¯ÙˆØ±Ø¨ÛŒÙ†: ' + (err.name || err.message));
      console.error(err);
    }
  });

  // ÙˆÙ‚ØªÛŒ ØªØµÙˆÛŒØ± Ù¾ÛŒØ¯Ø§ Ø´Ø¯
  sceneEl.addEventListener('targetFound', () => videoEl.play().catch(()=>{}));
  // ÙˆÙ‚ØªÛŒ Ú¯Ù… Ø´Ø¯
  sceneEl.addEventListener('targetLost', () => videoEl.pause());


  function explain(err){
  const name = err && (err.name || err.toString());
  alert('Camera error: ' + name + '\n' +
        (location.protocol !== 'https:' ? 'âš ï¸ Ø§ÛŒÙ† ØµÙØ­Ù‡ Ø±ÙˆÛŒ HTTPS Ù†ÛŒØ³Øª.\n' : '') +
        (!('mediaDevices' in navigator) ? 'âš ï¸ Ù…Ø±ÙˆØ±Ú¯Ø± Ø§Ø² getUserMedia Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ Ù†Ù…ÛŒâ€ŒÚ©Ù†Ø¯.\n' : '') +
        'Ù†Ú©Ø§Øª:\n- Ø³Ø§ÛŒØª Ø±Ø§ Ø¯Ø± Safari/Chrome Ø§ØµÙ„ÛŒ Ø¨Ø§Ø² Ú©Ù†.\n- Ù…Ø¬ÙˆØ² Camera Ø±Ø§ Allow Ú©Ù†.\n- Ø§Ù¾â€ŒÙ‡Ø§ÛŒ Ø¯ÙˆØ±Ø¨ÛŒÙ† Ø±Ø§ Ø¨Ø¨Ù†Ø¯.');
  console.error(err);
}
  </script>
</body>
</html>
